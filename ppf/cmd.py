#!/usr/bin/env python3
# -*- encoding: utf-8 -*-

import os
import re
import sys
import cmd
import configparser


class PPFCmd(cmd.Cmd):
    """Command line interpreter"""

    def __init__(self, config_path):
        cmd.Cmd.__init__(self)
        self.prompt = 'ppf > '
        self.config_path = config_path

        try:
            self.config = configparser.ConfigParser()
            self.config.read(self.config_path)
        except Exception as e:
            print("[-] Error reading ppf.conf: {}".format(e))
            sys.exit(1)
        
        self.project_basedir = self.config.get('projects', 'projects_directory')
        if not os.path.isdir(self.project_basedir):
            print("[-] Error creating cmd: {} is not a directory".format(self.project_basedir))
            sys.exit(1)
        
        self.proje

        #prompt password here
        #self.keepass_db = self.config.get('encryption', 'keepassxc_kdbx')
        #self.keepass_file = self.config.get('encryption', 'keepassxc_kdbx')
        #...
    

    def do_hello(self, args):
        """Says hello. If you provide a name, it will greet you with it."""
        if len(args) == 0:
            name = 'stranger'
        else:
            name = args
        print("Hello, %s" % name)

    def do_create(self, arg):
        #. On verifie que celui ci n'existe pas dans la liste des projets
        #. On cr√©e le repertoire dans la liste
        pattern = re.compile("^[A-Za-z0-9_.\-]+$")
        if not pattern.match(arg):
            print('[-] Error checking project name: project is invalid')
            sys.exit(1)
        



    def help_create(self):
        print("syntax: create <project>")
        print("")
        print("-- create a new project in {}".format(self.project_basedir))
        print("   the project name must be a mix of upper, lower, numbers")
        print("   and some special characters (`.-_`)")

    def do_list(self, args):
        print('Not implemented.')
        pass

    def help_list(self):
        print('Not implemented.')
        pass

    def do_encrypt(self, args):
        print('Not implemented.')
        pass
    
    def help_encrypt(self):
        print('Not implemented.')
        pass

    def do_archive(self, args):
        print('Not implemented.')
        pass
    
    def help_archive(self):
        print('Not implemented.')
        pass

    def do_quit(self, args):
        """Quits the program."""
        print("Quitting.")
        raise SystemExit