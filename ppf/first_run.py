#!/usr/bin/env python3
# -*- coding: utf-8-*-


import os
import sys
import ppf
import shutil
import configparser

PPF_PATH = os.path.expanduser('~/.ppf')
CONFIG_PATH = os.path.join(PPF_PATH, 'ppf.conf')

def first_run_setup():
    # create the user's PPF path if not exists
    if not os.path.exists(PPF_PATH):
        print("[*] Detecting first run setup, initialize environment...")
        os.mkdir(PPF_PATH)
    
    # if the projects does not contains the config file
    # copy it from data directory
    if not os.path.exists(CONFIG_PATH):
        default_path = os.path.join(os.path.dirname(ppf.__file__), 'data', 'ppf.conf')
        shutil.copy(default_path, PPF_PATH)
    
    try:
        config = configparser.ConfigParser()
        config.read(CONFIG_PATH)
    except Exception as e:
        print("[-] Error reading ppf.conf: {}".format(e))
        sys.exit(1)
    
    if not config['projects']['projects_directory']:
        print("[-] `projects_directory` is not configure, please edit your config file")
        sys.exit(1)
    if not config['encryption']['keepassxc_kdbx']:
        print("[-] `keepassxc_kdbx` is not configure, please edit your config file")
        sys.exit(1)

    # NOTE: control over user input is not performed here, 
    # but at the instanciation of the command line class. 
